#!/usr/bin/env bash

set -e

echo "====================================="
echo " OpenShift Cluster Information"
echo "====================================="

# Ensure oc is available
if ! command -v oc &>/dev/null; then
    echo "ERROR: oc CLI not found"
    exit 1
fi

echo

# -------------------------------------
# oc CLI Version
# -------------------------------------
echo ">> oc CLI Version"
oc version --client | sed 's/^/  /'
echo

# -------------------------------------
# Kubernetes Version
# -------------------------------------
echo ">> Kubernetes Version"
oc get clusterversion version -o jsonpath='{.status.version}{"\n"}'
echo

# -------------------------------------
# OpenShift Version
# -------------------------------------
echo ">> OpenShift Version"
oc get clusterversion version -o jsonpath='{.status.desired.version}{"\n"}'
echo

# -------------------------------------
# Service Mesh (Istio) Available Versions
# -------------------------------------
echo ">> Service Mesh (Istio) Available Versions"

if oc get csv -A | grep -qi servicemesh; then
    oc get csv -A | awk '
    BEGIN {
        printf "%-30s %-30s %-10s\n", "NAMESPACE", "OPERATOR", "VERSION"
    }
    /servicemesh|istio/ {
        printf "%-30s %-30s %-10s\n", $1, $2, $3
    }'
else
    echo "Service Mesh Operator not installed"
fi

echo

# -------------------------------------
# Storage Classes
# -------------------------------------
echo ">> Storage Classes"
oc get storageclass -o custom-columns=\
NAME:.metadata.name,\
PROVISIONER:.provisioner,\
DEFAULT:.metadata.annotations.storageclass\\.kubernetes\\.io/is-default-class
echo

# -------------------------------------
# Ingress Controllers
# -------------------------------------
echo ">> Ingress Controllers"
oc get ingresscontroller -n openshift-ingress-operator \
-o custom-columns=\
NAME:.metadata.name,\
DOMAIN:.status.domain,\
AVAILABLE:.status.conditions[?(@.type=="Available")].status
echo

echo
echo "====================================="
echo " Script Completed Successfully"
echo "====================================="






=================================

#!/usr/bin/env bash

set -e

echo "====================================="
echo " OpenShift Cluster Information"
echo "====================================="

# Ensure oc is available
if ! command -v oc &>/dev/null; then
    echo "ERROR: oc CLI not found"
    exit 1
fi

echo

# -------------------------------------
# oc CLI Version
# -------------------------------------
echo ">> oc CLI Version"
oc version --client | sed 's/^/  /'
echo

# -------------------------------------
# Kubernetes Version
# -------------------------------------
echo ">> Kubernetes Version"
oc get clusterversion version -o jsonpath='{.status.version}{"\n"}'
echo

# -------------------------------------
# OpenShift Version
# -------------------------------------
echo ">> OpenShift Version"
oc get clusterversion version -o jsonpath='{.status.desired.version}{"\n"}'
echo

# -------------------------------------
# Service Mesh (Istio) Installed Versions
# -------------------------------------
echo ">> Service Mesh (Istio) Installed Versions"

if oc get csv -A | grep -qi servicemesh; then
    oc get csv -A | awk '
    BEGIN {
        printf "%-30s %-35s %-10s\n", "NAMESPACE", "OPERATOR", "VERSION"
    }
    /servicemesh|istio/ {
        printf "%-30s %-35s %-10s\n", $1, $2, $3
    }'
else
    echo "Service Mesh Operator: NOT INSTALLED"
fi

echo

# -------------------------------------
# Storage Classes
# -------------------------------------
echo ">> Storage Classes"
oc get storageclass -o custom-columns=\
NAME:.metadata.name,\
PROVISIONER:.provisioner,\
DEFAULT:.metadata.annotations.storageclass\\.kubernetes\\.io/is-default-class
echo

# -------------------------------------
# Ingress Controllers
# -------------------------------------
echo ">> Ingress Controllers"
oc get ingresscontroller -n openshift-ingress-operator \
-o custom-columns=\
NAME:.metadata.name,\
DOMAIN:.status.domain,\
AVAILABLE:.status.conditions[?(@.type=="Available")].status
echo

# =====================================================
# ADDITIONAL RESOURCE CHECKS
# =====================================================

# -------------------------------------
# cert-manager Operator
# -------------------------------------
echo ">> cert-manager Operator"

CERT_MANAGER_CSV=$(oc get csv -A | awk '/cert-manager/ {print $1, $2, $3}')

if [[ -n "$CERT_MANAGER_CSV" ]]; then
    echo "INSTALLED:"
    echo "NAMESPACE  OPERATOR  VERSION"
    echo "$CERT_MANAGER_CSV"
else
    echo "cert-manager Operator: NOT INSTALLED"
fi

echo

# -------------------------------------
# PostgreSQL Version (best-effort detection)
# -------------------------------------
echo ">> PostgreSQL Version"

# Try to detect running PostgreSQL pods by common patterns
POSTGRES_IMAGE=$(oc get pods -A -o jsonpath='{range .items[*]}{.metadata.namespace}{"|"}{.spec.containers[*].image}{"\n"}{end}' \
    | grep -Ei 'postgres|postgresql' | head -n 1)

if [[ -n "$POSTGRES_IMAGE" ]]; then
    echo "INSTALLED:"
    echo "Detected image:"
    echo "  $POSTGRES_IMAGE"
    echo "NOTE: PostgreSQL version inferred from image tag"
else
    echo "PostgreSQL: NOT DETECTED"
fi

echo

# -------------------------------------
# MicroStrategy CMC Operator
# -------------------------------------
echo ">> MicroStrategy CMC Operator"

MICROSTRATEGY_CSV=$(oc get csv -A | awk '/microstrategy|mstr|cmc/ {print $1, $2, $3}')

if [[ -n "$MICROSTRATEGY_CSV" ]]; then
    echo "INSTALLED:"
    echo "NAMESPACE  OPERATOR  VERSION"
    echo "$MICROSTRATEGY_CSV"
else
    echo "MicroStrategy CMC Operator: NOT INSTALLED"
fi

echo
echo "====================================="
echo " Script Completed Successfully"
echo "====================================="
